/**
 * @license
 * elzoido-auth 0.1.0
 * (c) 2014 marigan.net
 * License: GPL-3.0+
 */
angular.module("elzoido.auth",[]).constant("elzoidoAuth",{install:function(n){return n.responseInterceptors.push(["$q","$rootScope",function(n,e){var t,o;return o=function(n){return n},t=function(t){return 401===t.status?(e.$broadcast("event:elzoido_auth_unauthenticated",t.status),n.reject(t)):403===t.status?(e.$broadcast("event:elzoido_auth_unauthorized",t.status),n.reject(t)):(e.$broadcast("event:elzoido_auth_error",t.status),n.reject(t))},function(n){return n.then(o,t)}}])},config:{userProvider:null,pathProfile:null,functionSignin:null,functionSignout:null,autoSignin:!1}}),angular.module("elzoido.navigation").run(["$templateCache",function(n){n.put("partials/user.html",'<!--\n# Copyright (C) 2014 marigan.net\n#\n# This file is part of elzoido-auth.\n#\n# elzoido-auth is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# elzoido-auth is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with elzoido-auth. If not, see <http://www.gnu.org/licenses/>.\n#\n# Authors: Michal Mocnak <michal@marigan.net>\n-->\n\n<li class="dropdown">\n    <a ng-show="user.isGuest()" href="#" ng-click="signin()">Sign In <span class="fa fa-sign-in"></span></a>\n\n    <a ng-hide="user.isGuest()" href="#" class="dropdown-toggle" data-toggle="dropdown">\n        <span class="fa fa-user"></span>\n        <span class="left-buffer-10">{{user.name}}</span>\n        <span class="caret"></span>\n    </a>\n    <ul ng-hide="user.isGuest()" class="dropdown-menu">\n        <li><a href="{{profile}}"><span class="fa fa-wrench"></span> Profile</a></li>\n        <li><a href="#" ng-click="signout()"><span class="fa fa-sign-out"></span> Sign Out</a></li>\n    </ul>\n</li>')}]),angular.module("elzoido.auth").directive("elzoidoAuthAccess",["$animate","elzoidoAuthUser",function(n,e){return{restrict:"A",link:function(t,o,i){var r;return r=function(t){return n[e.get().hasRoles(t)?"removeClass":"addClass"](o,"ng-hide")},t.$watch(i.elzoidoAuthAccess,function(){return _.isUndefined(i.elzoidoAuthAccess)?void 0:r(i.elzoidoAuthAccess)}),t.$on("event:elzoido_auth_user",function(){return _.isUndefined(i.elzoidoAuthAccess)?void 0:r(i.elzoidoAuthAccess)})}}}]),angular.module("elzoido.auth").directive("elzoidoAuthUser",function(){return{restrict:"A",transclude:!0,scope:{},controller:["$scope","$rootScope","elzoidoAuth","elzoidoAuthUser",function(n,e,t,o){return n.user=o.get(),n.profile=t.config.pathProfile,n.signin=function(){return t.config.functionSignin().then(function(){return e.$broadcast("event:elzoido_auth_signin")})},n.signout=function(){return t.config.functionSignout().then(function(){return e.$broadcast("event:elzoido_auth_signout")})},e.$on("event:elzoido_auth_user",function(){return n.user=o.get()})}],templateUrl:"partials/user.html",replace:!1}}),angular.module("elzoido.auth").factory("elzoidoAuthUser",["$rootScope","$injector","elzoidoAuth",function(n,e,t){var o,i,r,u;return u={name:"Guest",roles:["guest"]},r=function(n){return!_.isEmpty(_.intersection(i.roles,n.split(",")))},o=function(n){return _.merge(n,{isGuest:function(){return r("guest")},isAdmin:function(){return r("admin")},hasRoles:function(n){return r(n)}})},i=o(u),n.$on("event:elzoido_auth_signin",function(){return e.get(t.config.userProvider).profile(function(e){return i=o(e.user),n.$broadcast("event:elzoido_auth_user")})}),n.$on("event:elzoido_auth_signout",function(){return i=u}),t.config.autoSignin&&n.$broadcast("event:elzoido_auth_signin"),{get:function(){return i}}}]);