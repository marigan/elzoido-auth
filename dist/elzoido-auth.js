/**
 * @license
 * elzoido-auth 0.2.0
 * (c) 2014 marigan.net
 * License: GPL-3.0+
 */
angular.module("elzoido.auth",[]).constant("elzoidoAuthModule",{config:{userProvider:null,pathProfile:null,functionSignin:null,functionSignout:null}}),angular.module("elzoido.auth").run(["$templateCache",function(e){e.put("partials/user.html",'<!--\n# Copyright (C) 2014 marigan.net\n#\n# This file is part of elzoido-auth.\n#\n# elzoido-auth is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# elzoido-auth is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with elzoido-auth. If not, see <http://www.gnu.org/licenses/>.\n#\n# Authors: Michal Mocnak <michal@marigan.net>\n-->\n\n<li class="dropdown">\n    <a ng-show="user.isGuest()" href="#" ng-click="signin()">Sign In <span class="fa fa-sign-in"></span></a>\n\n    <a ng-hide="user.isGuest()" href="#" class="dropdown-toggle" data-toggle="dropdown">\n        <span class="fa fa-user"></span>\n        <span class="left-buffer-10">{{user.name}}</span>\n        <span class="caret"></span>\n    </a>\n    <ul ng-hide="user.isGuest()" class="dropdown-menu">\n        <li><a href="{{profile}}"><span class="fa fa-wrench"></span> Profile</a></li>\n        <li><a href="#" ng-click="signout()"><span class="fa fa-sign-out"></span> Sign Out</a></li>\n    </ul>\n</li>')}]),angular.module("elzoido.auth").directive("elzoidoAuthAccess",["$animate","elzoidoAuthUser",function(e,n){return{restrict:"A",scope:{roles:"@elzoidoAuthAccess"},link:function(t,o){var i;return i=function(){return _.isUndefined(t.roles)?void 0:e[n.get().hasRoles(t.roles)||_.isEmpty(t.roles)?"removeClass":"addClass"](o,"ng-hide")},i(),t.$on("event:elzoido-auth-user",function(){return i()})}}}]),angular.module("elzoido.auth").directive("elzoidoAuthUser",function(){return{restrict:"A",transclude:!0,scope:{},controller:["$scope","$rootScope","elzoidoAuthModule","elzoidoAuthUser","elzoidoAuthAPI",function(e,n,t,o,i){return e.user=o.get(),e.profile=t.config.pathProfile,e.signin=function(){return i.signin()},e.signout=function(){return i.signout()},n.$on("event:elzoido-auth-user",function(){return e.user=o.get()})}],templateUrl:"partials/user.html",replace:!1}}),angular.module("elzoido.auth").factory("elzoidoAuthAPI",["$rootScope","$injector","elzoidoAuthModule","elzoidoAuthUser",function(e,n,t,o){return{signin:function(){return t.config.functionSignin().then(function(){return e.$broadcast("event:elzoido-auth-signin"),o.signin()})},signout:function(){return t.config.functionSignout().then(function(){return e.$broadcast("event:elzoido-auth-signout"),o.signout()})}}}]),angular.module("elzoido.auth").factory("elzoidoAuthInterceptor",["$q","$rootScope",function(e,n){return{responseError:function(t){return 401===t.status?(n.$broadcast("event:elzoido-auth-unauthenticated",t.status),e.reject(t)):403===t.status?(n.$broadcast("event:elzoido-auth-unauthorized",t.status),e.reject(t)):(n.$broadcast("event:elzoido-auth-error",t.status),e.reject(t))}}}]),angular.module("elzoido.auth").factory("elzoidoAuthUser",["$rootScope","$injector","elzoidoAuthModule",function(e,n,t){var o,i,r,u;return u={name:"Guest",roles:["guest"]},r=function(e){return!_.isEmpty(_.intersection(i.roles,e.split(",")))},o=function(e){return _.merge(e,{isGuest:function(){return r("guest")},isAdmin:function(){return r("admin")},hasRoles:function(e){return r(e)}})},i=o(u),{get:function(){return i},signin:function(){return n.get(t.config.userProvider).profile(function(n){return i=o(n.user),e.$broadcast("event:elzoido-auth-user")})},signout:function(){return i=u}}}]);